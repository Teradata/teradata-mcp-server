---
phase: 05-ruff-enforcement
plan: 02
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - pyproject.toml
autonomous: true

must_haves:
  truths:
    - "pyproject.toml global ignore list does NOT contain F403 or F401"
    - "pyproject.toml per-file-ignores does NOT contain the */__init__.py line"
    - "pyproject.toml per-file-ignores STILL contains the tests/* line with F401, F403, PLR0913"
    - "ruff check passes clean on the entire src/ directory with zero F401 or F403 warnings"
    - "All handle_* functions discoverable by ModuleLoader remain discoverable"
    - "A wildcard import added to any __init__.py would be caught by ruff (enforcement active)"
  artifacts:
    - path: "pyproject.toml"
      provides: "Ruff config with F401/F403 enforcement enabled"
      contains: "per-file-ignores"
  key_links:
    - from: "pyproject.toml"
      to: "src/teradata_mcp_server/tools/*/__init__.py"
      via: "ruff lint rules now enforce explicit imports"
      pattern: "tool.ruff.lint"
---

<objective>
Remove F403 and F401 suppressions from pyproject.toml and verify that ruff check passes clean across the entire source tree. This is the final plan -- it locks in the enforcement so wildcard imports cannot be reintroduced undetected.

Purpose: With all F401 violations fixed (Plan 01) and all 12 tool packages having `__all__`, the suppression entries are no longer needed. Removing them activates ruff's F401/F403 enforcement, which means any future wildcard import or unused import in non-test code will cause an immediate lint failure.

Output: Updated pyproject.toml. Clean `ruff check` across all source files. Confirmed handler discovery unchanged.
</objective>

<execution_context>
@/Users/Daniel.Tehan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Daniel.Tehan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ruff-enforcement/05-RESEARCH.md
@.planning/phases/05-ruff-enforcement/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove F403/F401 suppressions from pyproject.toml</name>
  <files>
    pyproject.toml
  </files>
  <action>
Make exactly 3 edits to `pyproject.toml`:

**Edit 1: Remove F403 from global ignore list**

In `[tool.ruff.lint]` `ignore` array, remove the line:
```
    "F403",  # Wildcard imports (temporarily ignore for gradual refactoring)
```

**Edit 2: Remove F401 from global ignore list**

In the same `ignore` array, remove the line:
```
    "F401",  # Unused imports in __init__.py files (common pattern for re-exports)
```

**Edit 3: Remove `*/__init__.py` per-file-ignores line**

In `[tool.ruff.lint.per-file-ignores]`, remove the line:
```
"*/__init__.py" = ["F403", "F401"]  # Allow wildcard imports and unused imports in __init__.py
```

**DO NOT** remove or modify the `tests/*` per-file-ignores line:
```
"tests/*" = ["F401", "F403", "PLR0913"]  # More lenient for test files
```
This line MUST remain -- test setup scripts legitimately use `from teradataml import *`.

The resulting `[tool.ruff.lint]` ignore list should contain:
```toml
ignore = [
    "E402",  # Module level import not at top (some tools have conditional imports)
    "E501",  # strings over 120 characters
    "N816",  # Variable naming (existing legacy naming)
    "N802",  # Function naming (preserve existing naming conventions)
    "N803",  # Argument naming (preserve existing naming conventions)
    "B905",  # zip() without explicit strict parameter (backwards compatibility)
    "B008",  # Function call in default argument (existing pattern)
    "F841",  # Unused variable (may be intentional in some cases)
    "PLR0913", # Too many arguments (common in database tools)
    "PLR0912", # Too many branches (common in conditional logic)
    "PLR0915", # Too many statements (common in setup functions)
    "PLW0603", # Use of globals statements
    "PLC0415", # Import statements outside the module top level scope
]
```

And the resulting `[tool.ruff.lint.per-file-ignores]` should be:
```toml
[tool.ruff.lint.per-file-ignores]
"tests/*" = ["F401", "F403", "PLR0913"]  # More lenient for test files
```
  </action>
  <verify>
1. Confirm F403 and F401 are NOT in the global ignore list:
   `grep -n "F403\|F401" pyproject.toml` -- should only show the `tests/*` per-file-ignores line, NOT any global ignore entries or `*/__init__.py` entries

2. Confirm `tests/*` per-file-ignores is preserved:
   `grep "tests" pyproject.toml` -- must show the `"tests/*" = ["F401", "F403", "PLR0913"]` line

3. Run ruff check on the ENTIRE src/ directory (not just specific files):
   `uv run ruff check src/`
   This must pass with zero violations. This is the definitive test -- with global F401/F403 suppression removed, any remaining violations will now surface.

4. Run ruff specifically for F401 and F403 to double-check:
   `uv run ruff check --select F401,F403 src/`
   Must report zero violations.

5. Confirm enforcement is active -- verify a hypothetical wildcard import WOULD be caught. Create a temporary test:
   ```bash
   echo "from .base_tools import *" > /tmp/test_init.py
   uv run ruff check --select F403 --config pyproject.toml /tmp/test_init.py
   ```
   This should report an F403 violation, proving enforcement is active. (Clean up the temp file after.)

   Alternative simpler verification: confirm `F403` does NOT appear in the ruff ignore list:
   `uv run python -c "
import tomllib
with open('pyproject.toml', 'rb') as f:
    config = tomllib.load(f)
ignores = config['tool']['ruff']['lint']['ignore']
pfi = config['tool']['ruff']['lint']['per-file-ignores']
assert 'F403' not in ignores, f'F403 still in global ignore: {ignores}'
assert 'F401' not in ignores, f'F401 still in global ignore: {ignores}'
assert '*/__init__.py' not in pfi, f'__init__.py still in per-file-ignores: {pfi}'
assert 'tests/*' in pfi, f'tests/* missing from per-file-ignores: {pfi}'
print('pyproject.toml config verified')
"`

6. Confirm all handlers still discoverable (final ModuleLoader verification):
   `uv run python -c "
import inspect, importlib
EXPECTED = {
    'tmpl': 1, 'sec': 3, 'rag': 1, 'dba': 6, 'qlty': 7,
    'chat': 2, 'base': 8, 'bar': 6, 'plot': 4, 'sql_opt': 3, 'tdvs': 10,
}
total = 0
for pkg, count in EXPECTED.items():
    try:
        m = importlib.import_module(f'teradata_mcp_server.tools.{pkg}')
        handlers = [n for n, _ in inspect.getmembers(m, inspect.isfunction) if n.startswith('handle_')]
        assert len(handlers) == count, f'{pkg}: expected {count}, got {len(handlers)}'
        total += len(handlers)
        print(f'  {pkg}: {len(handlers)} handlers')
    except ImportError as e:
        if 'tdfs4ds' in str(e) and pkg == 'fs':
            total += count
            print(f'  {pkg}: SKIPPED')
        else: raise
# Also check FeatureStoreConfig
try:
    m = importlib.import_module('teradata_mcp_server.tools.fs')
    classes = [n for n, _ in inspect.getmembers(m, inspect.isclass)]
    assert 'FeatureStoreConfig' in classes, f'FeatureStoreConfig missing from fs'
    print(f'  fs: FeatureStoreConfig present')
except ImportError:
    print(f'  fs: SKIPPED (FeatureStoreConfig check)')
print(f'Handler discovery verified: {total} handlers')
"`

All checks must pass with zero errors.
  </verify>
  <done>
pyproject.toml no longer contains F403 or F401 in the global ignore list. The `*/__init__.py` per-file-ignores line is removed. The `tests/*` per-file-ignores line is preserved. `ruff check src/` passes with zero violations. `ruff check --select F401,F403 src/` passes with zero violations. All handlers remain discoverable (51 handlers + 1 class across 12 tool packages). F403/F401 enforcement is now active -- any new wildcard or unused import will cause an immediate ruff failure.
  </done>
</task>

</tasks>

<verification>
After all tasks are complete, confirm ALL Phase 5 success criteria from ROADMAP.md:

1. `pyproject.toml` no longer contains F403 or F401 suppression entries for `__init__.py` files -- VERIFIED by grep and tomllib parse
2. `ruff check` passes with zero import-related warnings across all modified files -- VERIFIED by `ruff check src/` and `ruff check --select F401,F403 src/`
3. All `handle_*` functions currently discoverable by `ModuleLoader` remain discoverable after all cleanups -- VERIFIED by 12-package handler count check (51 handlers + 1 class)
4. A developer introducing a new wildcard import in any `__init__.py` will see an immediate ruff failure -- VERIFIED by confirming F403 is not in any ignore/per-file-ignores for `__init__.py`
</verification>

<success_criteria>
- F403 removed from pyproject.toml global ignore
- F401 removed from pyproject.toml global ignore
- `*/__init__.py` per-file-ignores line removed
- `tests/*` per-file-ignores line preserved
- `ruff check src/` passes clean (zero violations)
- `ruff check --select F401,F403 src/` passes clean
- All 51 handlers + 1 class discoverable across 12 tool packages
- Wildcard import enforcement is active for all non-test code
</success_criteria>

<output>
After completion, create `.planning/phases/05-ruff-enforcement/05-02-SUMMARY.md`
</output>
